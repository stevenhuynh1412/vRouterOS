# Làm việc với cấu hình trong vRouterOS

## Giới thiệu
Tài liệu này mô tả các khái niệm cơ bản và hướng dẫn chi tiết về cách làm việc với hệ thống cấu hình trong **vRouterOS** (dựa trên vRouterOS). Hệ thống cấu hình của vRouterOS được tổ chức theo mô hình phân cấp, hỗ trợ quản lý cấu hình candidate và running, cùng các công cụ để xem, chỉnh sửa, và quản lý cấu hình :cite[1].

## Các khái niệm cơ bản

### Thuật ngữ
- **Active/Running Configuration**: Cấu hình đang được tải và sử dụng bởi hệ thống.
- **Candidate Configuration**: Cấu hình tạm thời khi bạn thực hiện thay đổi trong chế độ cấu hình. Thay đổi chỉ trở thành active sau khi commit :cite[1].

### Cấu trúc phân cấp
Cấu hình vRouterOS được tổ chức dưới dạng cây phân cấp, bao gồm:
- **Configuration Nodes**: Các nút cấu hình (single-node hoặc multi-node).
- **Attribute Statements**: Các thuộc tính thiết lập giá trị cho các tham số trong nút :cite[1].

## Điều hướng trong chế độ cấu hình
Các lệnh điều hướng chính trong chế độ cấu hình:
- `edit <config-node>`: Di chuyển đến nút cấu hình chỉ định.
- `exit`: Thoát về đầu cây cấu hình hoặc thoát khỏi chế độ cấu hình.
- `top`: Quay về đầu cây cấu hình.
- `up`: Di chuyển lên một nút trong cây cấu hình :cite[1].

## Xem cấu hình
### Trong chế độ cấu hình
Sử dụng lệnh `show` để hiển thị cấu hình. Ví dụ:
```bash
vRouterOS@R1# show interfaces dataplane dp0p1s1
dataplane dp0p1s1 {
    address 10.10.1.1/24
    mac 00:13:46:e6:f6:87
}

# Hướng dẫn làm việc với cấu hình trong vRouterOS

## Giới thiệu

Hệ thống cấu hình trong vRouterOS được chia thành hai trạng thái chính:

- **Cấu hình đang chạy (Running configuration)**: Là cấu hình hiện tại mà hệ thống đang sử dụng.
- **Cấu hình làm việc (Working configuration)**: Là bản sao của cấu hình đang chạy, được chỉnh sửa trong chế độ cấu hình. Các thay đổi trong cấu hình làm việc không ảnh hưởng đến hệ thống cho đến khi được **commit** (áp dụng).

Cấu hình được lưu dưới dạng **câu lệnh cấu hình** (configuration statements) trong một hệ thống phân cấp giống như cây thư mục. Các câu lệnh này có thể được thêm, xóa hoặc sửa đổi bằng cách sử dụng các lệnh trong **chế độ cấu hình** hoặc thông qua các công cụ như **RESTCONF API**.

Trong tài liệu này, các lệnh được biểu diễn như sau:
- **Chế độ vận hành (Operational mode)**: Các lệnh bắt đầu bằng ký hiệu `$`.
- **Chế độ cấu hình (Configuration mode)**: Các lệnh bắt đầu bằng ký hiệu `#`.

## Các chế độ làm việc

### Chế độ vận hành (Operational Mode)
- Đây là chế độ mặc định khi bạn đăng nhập vào hệ thống.
- Trong chế độ này, bạn có thể:
  - Kiểm tra trạng thái hệ thống.
  - Thực hiện các lệnh vận hành (như ping, traceroute).
  - Xem cấu hình đang chạy bằng lệnh `show configuration`.
- Ví dụ:
  ```
  $ show configuration
  ```
  Hiển thị cấu hình hiện tại của hệ thống.

### Chế độ cấu hình (Configuration Mode)
- Để chỉnh sửa cấu hình, bạn cần chuyển sang chế độ cấu hình bằng lệnh:
  ```
  $ configure
  ```
  - Sau khi chạy lệnh này, bạn sẽ thấy dấu nhắc lệnh thay đổi thành `#`.
- Trong chế độ cấu hình, bạn có thể:
  - Thêm, sửa đổi hoặc xóa các câu lệnh cấu hình.
  - Các thay đổi được lưu vào **cấu hình làm việc** và không ảnh hưởng đến hệ thống cho đến khi bạn **commit** chúng.
- Để thoát chế độ cấu hình:
  ```
  # exit
  ```

## Các lệnh cấu hình cơ bản

### 1. Xem cấu hình
- Trong chế độ vận hành, để xem cấu hình đang chạy:
  ```
  $ show configuration
  ```
  - Hiển thị cấu hình ở định dạng cây cấu hình (configuration tree format).
- Để xem dưới dạng tập hợp các lệnh set/delete:
  ```
  $ show configuration commands
  ```
- Trong chế độ cấu hình, để xem cấu hình làm việc:
  ```
  # show
  ```

### 2. Thêm câu lệnh cấu hình
- Trong chế độ cấu hình, sử dụng lệnh `set` để thêm hoặc sửa đổi một câu lệnh:
  ```
  # set interfaces dataplane dp0s3 address 192.0.2.1/24
  ```
  - Lệnh này đặt địa chỉ IP `192.0.2.1/24` cho giao diện `dp0s3`.
- Để thêm nhiều giá trị cho một node (multi-valued node):
  ```
  # set interfaces dataplane dp0s3 address 192.0.2.2/24
  ```
  - Thêm địa chỉ IP thứ hai cho cùng giao diện.

### 3. Xóa câu lệnh cấu hình
- Sử dụng lệnh `delete` để xóa một node hoặc giá trị:
  ```
  # delete interfaces dataplane dp0s3 address 192.0.2.2/24
  ```
  - Xóa địa chỉ IP cụ thể khỏi giao diện `dp0s3`.
- Để xóa toàn bộ node:
  ```
  # delete interfaces dataplane dp0s3
  ```
  - Xóa tất cả cấu hình của giao diện `dp0s3`.

### 4. Áp dụng thay đổi (Commit)
- Sau khi chỉnh sửa cấu hình làm việc, áp dụng thay đổi bằng:
  ```
  # commit
  ```
  - Các thay đổi sẽ được áp dụng vào cấu hình đang chạy và có hiệu lực ngay lập tức.
- Nếu có lỗi trong cấu hình (ví dụ: cấu hình không hợp lệ), lệnh `commit` sẽ báo lỗi và không áp dụng thay đổi.

### 5. Lưu cấu hình
- Để lưu cấu hình đang chạy vào file (mặc định là `/config/config.boot`):
  ```
  $ save
  ```
  - File này được sử dụng khi hệ thống khởi động lại.
- Để lưu vào file khác:
  ```
  $ save /config/myconfig.conf
  ```

### 6. Khôi phục cấu hình
- Để tải cấu hình từ file:
  ```
  $ load /config/myconfig.conf
  ```
  - Sau khi tải, bạn cần chạy `commit` trong chế độ cấu hình để áp dụng.
- Để khôi phục về cấu hình mặc định:
  ```
  $ load /config/config.boot.default
  ```

### 7. So sánh cấu hình
- Để so sánh cấu hình làm việc với cấu hình đang chạy:
  ```
  # compare
  ```
  - Hiển thị các thay đổi chưa commit (thêm, xóa, sửa đổi).

### 8. Hủy bỏ thay đổi
- Để hủy bỏ các thay đổi chưa commit trong cấu hình làm việc:
  ```
  # discard
  ```
  - Đưa cấu hình làm việc trở về trạng thái giống cấu hình đang chạy.

## Ví dụ thực tế

### Cấu hình địa chỉ IP cho giao diện
1. Chuyển sang chế độ cấu hình:
   ```
   $ configure
   ```
2. Thêm địa chỉ IP:
   ```
   # set interfaces dataplane dp0s3 address 192.0.2.1/24
   ```
3. Kiểm tra cấu hình làm việc:
   ```
   # show interfaces dataplane dp0s3
   ```
   Kết quả:
   ```
   address 192.0.2.1/24
   ```
4. Áp dụng thay đổi:
   ```
   # commit
   ```
5. Lưu cấu hình:
   ```
   # save
   ```
6. Thoát chế độ cấu hình:
   ```
   # exit
   ```
7. Xem cấu hình đang chạy:
   ```
   $ show configuration
   ```

### Xóa địa chỉ IP
1. Vào chế độ cấu hình:
   ```
   $ configure
   ```
2. Xóa địa chỉ IP:
   ```
   # delete interfaces dataplane dp0s3 address 192.0.2.1/24
   ```
3. Kiểm tra thay đổi:
   ```
   # compare
   ```
   Kết quả:
   ```
   - interfaces dataplane dp0s3 address 192.0.2.1/24
   ```
4. Áp dụng:
   ```
   # commit
   ```
5. Lưu:
   ```
   # save
   ```

## Lưu ý quan trọng
- **Cẩn thận khi commit**: Các thay đổi được commit sẽ có hiệu lực ngay lập tức. Nếu cấu hình sai, hệ thống có thể mất kết nối hoặc hoạt động không đúng.
- **Sao lưu cấu hình**: Luôn sao lưu cấu hình trước khi thay đổi lớn:
  ```
  $ save /config/backup-YYYYMMDD.conf
  ```
- **Kiểm tra lỗi**: Nếu `commit` thất bại, kiểm tra thông báo lỗi để sửa cấu hình.
- **Tài liệu tham khảo**: Xem thêm chi tiết tại trang tài liệu chính thức của vRouterOS hoặc các trang liên quan trên https://vRouterOS-project.fwcloud.co.

## Kết luận
Hệ thống cấu hình của vRouterOS mạnh mẽ và linh hoạt, cho phép quản lý cấu hình thông qua chế độ vận hành và cấu hình. Sử dụng các lệnh như `set`, `delete`, `commit`, `save`, và `load` để quản lý hiệu quả. Hãy thực hành các ví dụ trên để làm quen với quy trình.