# Hướng dẫn các lệnh quản lý hệ thống trong vRouterOS

## Giới thiệu

Trong **vRouterOS**, các lệnh quản lý hệ thống cho phép thực hiện các tác vụ như khởi động lại, tắt máy, cập nhật phần mềm, và kiểm tra trạng thái hệ thống. Các lệnh này chủ yếu được thực thi trong **chế độ vận hành** (ký hiệu `$`), nhưng một số tác vụ có thể yêu cầu chuyển sang **chế độ cấu hình** (ký hiệu `#`) để cấu hình các thông số liên quan.

Tài liệu này mô tả các lệnh quản lý hệ thống chính, cú pháp, và cách sử dụng chúng để duy trì và giám sát hệ thống vRouterOS.

## Các lệnh quản lý hệ thống cơ bản

### 1. Khởi động lại hệ thống
- **Mô tả**: Khởi động lại toàn bộ hệ thống vRouterOS, áp dụng cấu hình đã lưu và khởi động lại tất cả các dịch vụ.
- **Lệnh**:
  ```
  $ reboot
  ```
- **Ví dụ**:
  ```
  $ reboot
  Reboot the system? [confirm][y]
  ```
  - Nhấn `y` để xác nhận. Hệ thống sẽ khởi động lại.
- **Lưu ý**: Đảm bảo lưu cấu hình trước khi khởi động lại:
  ```
  $ save
  Saving configuration to '/config/config.boot'...
  Done
  ```

### 2. Tắt hệ thống
- **Mô tả**: Tắt hệ thống vRouterOS một cách an toàn, dừng tất cả các dịch vụ và tắt nguồn.
- **Lệnh**:
  ```
  $ poweroff
  ```
- **Ví dụ**:
  ```
  $ poweroff
  Power off the system? [confirm][y]
  ```
  - Nhấn `y` để xác nhận. Hệ thống sẽ tắt.
- **Lưu ý**: Lưu cấu hình trước khi tắt để tránh mất thay đổi:
  ```
  $ save
  ```

### 3. Cập nhật phần mềm
- **Mô tả**: Cập nhật phần mềm vRouterOS lên phiên bản mới hơn bằng cách tải và cài đặt image hệ thống từ một nguồn (như URL hoặc file cục bộ).
- **Lệnh**:
  ```
  $ add system image <url-or-path>
  ```
  - `<url-or-path>`: Đường dẫn đến file image (ví dụ: HTTP/HTTPS, FTP, hoặc đường dẫn cục bộ như `/config/vrouteros-image.iso`).
- **Ví dụ**:
  ```
  $ add system image http://repos.vrouteros.org/vrouteros-2105.iso
  Downloading vrouteros-2105.iso...
  Installing new system image...
  Do you want to make this the default boot image? [y/n] y
  ```
  - Sau khi cài đặt, hệ thống sẽ khởi động lại để sử dụng image mới.
- **Lưu ý**:
  - Đảm bảo kết nối mạng hoạt động nếu tải từ URL.
  - Kiểm tra tính toàn vẹn của image (nếu có checksum).
  - Sao lưu cấu hình trước khi cập nhật:
    ```
    $ save /config/backup-YYYYMMDD.conf
    ```

### 4. Kiểm tra phiên bản hệ thống
- **Mô tả**: Hiển thị thông tin về phiên bản vRouterOS hiện tại, bao gồm phiên bản phần mềm, kernel, và thời gian build.
- **Lệnh**:
  ```
  $ show version
  ```
- **Ví dụ**:
  ```
  $ show version
  Version:      vRouterOS 2105
  Description:  vRouterOS 2105
  Kernel:       5.4.0-vyatta
  Built on:     Wed Sep 01 00:00:00 UTC 2021
  ```
- **Lưu ý**: Sử dụng lệnh này để xác minh phiên bản trước và sau khi cập nhật.

### 5. Kiểm tra trạng thái hệ thống
- **Mô tả**: Hiển thị thông tin về trạng thái hệ thống, bao gồm thời gian hoạt động, tải CPU, và sử dụng bộ nhớ.
- **Lệnh**:
  ```
  $ show system uptime
  $ show system memory
  $ show system cpu
  ```
- **Ví dụ**:
  ```
  $ show system uptime
  10:15:32 up 2 days,  3:45,  1 user,  load average: 0.08, 0.03, 0.01
  ```
  ```
  $ show system memory
  total       used       free     shared    buffers     cached
  Mem:       3900M       500M      3400M       100M       200M       300M
  ```
  ```
  $ show system cpu
  CPU  %usr  %sys  %idle
  0    10.0   5.0   85.0
  1     8.0   3.0   89.0
  ```
- **Lưu ý**: Các lệnh này hữu ích để giám sát hiệu suất và tài nguyên hệ thống.

### 6. Quản lý dịch vụ
- **Mô tả**: Khởi động, dừng, hoặc khởi động lại các dịch vụ hệ thống (như `dataplane`, `sshd`).
- **Lệnh**:
  ```
  $ restart <service>
  $ stop <service>
  $ start <service>
  ```
- **Ví dụ**:
  ```
  $ restart dataplane
  Restarting dataplane service...
  Done
  ```
  ```
  $ stop sshd
  Stopping sshd service...
  Done
  ```
  ```
  $ start sshd
  Starting sshd service...
  Done
  ```
- **Lưu ý**: Chỉ sử dụng cho các dịch vụ được vRouterOS hỗ trợ. Kiểm tra danh sách dịch vụ:
  ```
  $ show system services
  ```

### 7. Sao lưu và khôi phục cấu hình
- **Mô tả**: Sao lưu hoặc khôi phục cấu hình hệ thống để đảm bảo an toàn hoặc khôi phục trạng thái trước đó.
- **Lệnh**:
  - Sao lưu:
    ```
    $ save [<file>]
    ```
  - Khôi phục:
    ```
    $ load <file>
    ```
- **Ví dụ**:
  ```
  $ save /config/backup-20250907.conf
  Saving configuration to '/config/backup-20250907.conf'...
  Done
  ```
  ```
  $ load /config/backup-20250907.conf
  $ configure
  # commit
  # save
  ```
- **Lưu ý**: Luôn sao lưu trước khi thực hiện các thay đổi lớn hoặc cập nhật phần mềm.

### 8. Xem nhật ký hệ thống
- **Mô tả**: Hiển thị nhật ký hệ thống để kiểm tra lỗi hoặc sự kiện.
- **Lệnh**:
  ```
  $ show log
  ```
- **Ví dụ**:
  ```
  $ show log
  Sep 07 10:15:32 vRouter1 systemd[1]: Started dataplane service.
  Sep 07 10:15:35 vRouter1 sshd[1234]: Accepted password for admin from 192.0.2.10
  ```
- **Lưu ý**: Để lọc nhật ký, sử dụng:
  ```
  $ show log | match <keyword>
  ```
  Ví dụ:
  ```
  $ show log | match dataplane
  ```

## Ví dụ thực tế: Quản lý hệ thống cơ bản
1. Kiểm tra phiên bản và trạng thái:
   ```
   $ show version
   Version:      vRouterOS 2105
   Kernel:       5.4.0-vyatta
   ```
   ```
   $ show system uptime
   10:15:32 up 2 days,  3:45,  1 user,  load average: 0.08, 0.03, 0.01
   ```
2. Sao lưu cấu hình:
   ```
   $ save /config/backup-20250907.conf
   Saving configuration to '/config/backup-20250907.conf'...
   Done
   ```
3. Cập nhật phần mềm:
   ```
   $ add system image http://repos.vrouteros.org/vrouteros-2105.iso
   Downloading vrouteros-2105.iso...
   Installing new system image...
   Do you want to make this the default boot image? [y/n] y
   ```
4. Khởi động lại hệ thống:
   ```
   $ reboot
   Reboot the system? [confirm][y]
   ```
5. Kiểm tra nhật ký sau khi khởi động lại:
   ```
   $ show log | match dataplane
   Sep 07 10:20:01 vRouter1 systemd[1]: Started dataplane service.
   ```

## Lưu ý quan trọng
- **Sao lưu trước khi thay đổi**: Luôn sao lưu cấu hình trước khi cập nhật phần mềm, khởi động lại, hoặc tắt máy:
  ```
  $ save /config/backup-YYYYMMDD.conf
  ```
- **Xác nhận hành động nguy hiểm**: Các lệnh như `reboot` hoặc `poweroff` yêu cầu xác nhận để tránh thực thi nhầm.
- **Kiểm tra kết nối mạng**: Đảm bảo kết nối mạng ổn định khi cập nhật phần mềm từ URL.
- **Giám sát hệ thống**: Sử dụng `show system uptime`, `show system memory`, và `show system cpu` để theo dõi hiệu suất.
- **Tài liệu tham khảo**: Xem thêm chi tiết trên trang tài liệu vRouterOS hoặc tại https://docs.fwcloud.co

## Kết luận
Các lệnh quản lý hệ thống trong vRouterOS cung cấp các công cụ mạnh mẽ để duy trì, cập nhật, và giám sát hệ thống. Sử dụng các lệnh như `reboot`, `poweroff`, `add system image`, `show version`, và `show log` để quản lý hiệu quả. Thực hành các ví dụ trên để làm quen với quy trình quản lý hệ thống.