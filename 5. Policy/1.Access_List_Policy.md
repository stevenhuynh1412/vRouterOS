# Hướng dẫn cấu hình Access List Policy trong vRouterOS

## Giới thiệu

**Access List Policy** trong **vRouterOS** là một cơ chế kiểm soát lưu lượng mạng dựa trên địa chỉ IP nguồn và đích, được áp dụng trên các giao diện mạng. Access List (ACL) cho phép lọc gói tin để chấp nhận hoặc từ chối lưu lượng, thường được sử dụng để tăng cường bảo mật hoặc quản lý truy cập mạng.

Tài liệu này hướng dẫn cách:
- Tạo và cấu hình Access List với các quy tắc (rules).
- Áp dụng Access List vào giao diện mạng.
- Kiểm tra và giám sát trạng thái Access List.

Các lệnh được thực thi trong **chế độ vận hành** (ký hiệu `$`) hoặc **chế độ cấu hình** (ký hiệu `#`). Các thay đổi cần được **commit** để có hiệu lực và **lưu** để duy trì sau khi khởi động lại.

## Tổng quan về Access List Policy

- **Access List (ACL)**: Một tập hợp các quy tắc (rules) được đánh số, xác định cách xử lý lưu lượng mạng dựa trên địa chỉ IP nguồn và đích.
- **Hành động (Action)**:
  - `permit`: Cho phép gói tin đi qua.
  - `deny`: Từ chối gói tin.
- **Hướng áp dụng**:
  - `in`: Lưu lượng vào giao diện.
  - `out`: Lưu lượng ra từ giao diện.
- **Ưu điểm**:
  - Đơn giản, dễ cấu hình cho các kịch bản lọc cơ bản.
  - Hiệu suất cao, phù hợp với các hệ thống có lưu lượng lớn.
- **Hạn chế**: Chỉ lọc dựa trên địa chỉ IP, không hỗ trợ các tiêu chí phức tạp như cổng hoặc giao thức (dùng tường lửa cho các yêu cầu này).

## Các lệnh cấu hình Access List

### 1. Tạo Access List
- **Mô tả**: Tạo một Access List với các quy tắc để cho phép hoặc từ chối lưu lượng dựa trên địa chỉ IP.
- **Lệnh**:
  ```
  # set policy access-list <list-id> rule <rule-number> action <permit|deny>
  # set policy access-list <list-id> rule <rule-number> source <ip-address/prefix>
  # set policy access-list <list-id> rule <rule-number> destination <ip-address/prefix>
  ```
  - `<list-id>`: ID của Access List (1-2699).
  - `<rule-number>`: Số thứ tự quy tắc (1-65535).
  - `<ip-address/prefix>`: Địa chỉ IP và mặt nạ (ví dụ: `192.168.1.0/24`).
- **Ví dụ**:
  ```
  $ configure
  # set policy access-list 100 rule 10 action permit
  # set policy access-list 100 rule 10 source 192.168.1.0/24
  # set policy access-list 100 rule 10 destination 10.0.0.0/24
  # set policy access-list 100 rule 20 action deny
  # set policy access-list 100 rule 20 source any
  # set policy access-list 100 rule 20 destination any
  # commit
  # save
  Saving configuration to '/config/config.boot'...
  Done
  ```
  - Tạo Access List 100:
    - Quy tắc 10: Cho phép lưu lượng từ `192.168.1.0/24` đến `10.0.0.0/24`.
    - Quy tắc 20: Từ chối tất cả lưu lượng còn lại.

### 2. Áp dụng Access List vào giao diện
- **Mô tả**: Gắn Access List vào giao diện với hướng cụ thể (`in` hoặc `out`).
- **Lệnh**:
  ```
  # set interfaces dataplane <interface> access-list <list-id> <in|out>
  ```
  - `<interface>`: Tên giao diện (ví dụ: `dp0s3`).
- **Ví dụ**:
  ```
  # set interfaces dataplane dp0s3 access-list 100 in
  # commit
  # save
  ```
  - Áp dụng Access List 100 cho lưu lượng vào (`in`) trên giao diện `dp0s3`.

### 3. Kiểm tra cấu hình Access List
- **Mô tả**: Xem cấu hình Access List hiện tại.
- **Lệnh**:
  - Trong chế độ cấu hình:
    ```
    # show policy access-list
    ```
  - Trong chế độ vận hành:
    ```
    $ show configuration commands | match access-list
    ```
- **Ví dụ**:
  ```
  # show policy access-list
  access-list 100 {
      rule 10 {
          action permit
          source 192.168.1.0/24
          destination 10.0.0.0/24
      }
      rule 20 {
          action deny
          source any
          destination any
      }
  }
  ```

### 4. Kiểm tra trạng thái Access List
- **Mô tả**: Hiển thị thống kê Access List, bao gồm số gói tin và byte khớp với các quy tắc.
- **Lệnh**:
  ```
  $ show policy access-list <list-id>
  ```
- **Ví dụ**:
  ```
  $ show policy access-list 100
  Rule    Action    Source          Destination     Packets    Bytes
  ----    ------    ------          -----------     -------    -----
  10      permit    192.168.1.0/24  10.0.0.0/24     1500       120000
  20      deny      any             any             500        40000
  ```
  - Hiển thị số gói tin và byte khớp với các quy tắc trong Access List 100.

### 5. Xóa Access List
- **Mô tả**: Xóa Access List hoặc một quy tắc cụ thể.
- **Lệnh**:
  ```
  # delete policy access-list <list-id> rule <rule-number>
  # delete policy access-list <list-id>
  ```
- **Ví dụ**:
  ```
  $ configure
  # delete policy access-list 100 rule 10
  # commit
  # save
  ```
  - Xóa quy tắc 10 trong Access List 100.
  ```
  # delete policy access-list 100
  # commit
  # save
  ```
  - Xóa toàn bộ Access List 100.

### 6. So sánh và hủy bỏ thay đổi
- **So sánh cấu hình**:
  ```
  # compare
  ```
  - Hiển thị sự khác biệt giữa cấu hình làm việc và cấu hình đang chạy.
  - Ví dụ:
    ```
    # compare
    + policy access-list 100 rule 10 action permit
    + policy access-list 100 rule 10 source 192.168.1.0/24
    ```
- **Hủy bỏ thay đổi**:
  ```
  # discard
  ```
  - Hủy các thay đổi chưa commit.

## Ví dụ thực tế: Cấu hình Access List để lọc lưu lượng
1. Vào chế độ cấu hình:
   ```
   $ configure
   ```
2. Tạo Access List:
   ```
   # set policy access-list 100 rule 10 action permit
   # set policy access-list 100 rule 10 source 192.168.1.0/24
   # set policy access-list 100 rule 10 destination 10.0.0.0/24
   # set policy access-list 100 rule 20 action deny
   # set policy access-list 100 rule 20 source any
   # set policy access-list 100 rule 20 destination any
   ```
3. Áp dụng Access List vào giao diện:
   ```
   # set interfaces dataplane dp0s3 access-list 100 in
   ```
4. Kiểm tra cấu hình:
   ```
   # show policy access-list
   access-list 100 {
       rule 10 {
           action permit
           source 192.168.1.0/24
           destination 10.0.0.0/24
       }
       rule 20 {
           action deny
           source any
           destination any
       }
   }
   ```
5. Áp dụng và lưu:
   ```
   # commit
   # save
   Saving configuration to '/config/config.boot'...
   Done
   # exit
   ```
6. Kiểm tra trạng thái:
   ```
   $ show policy access-list 100
   Rule    Action    Source          Destination     Packets    Bytes
   ----    ------    ------          -----------     -------    -----
   10      permit    192.168.1.0/24  10.0.0.0/24     1500       120000
   20      deny      any             any             500        40000
   ```

## Lưu ý quan trọng
- **Thứ tự quy tắc**: Quy tắc được xử lý theo số thứ tự (`rule-number`). Quy tắc có số nhỏ hơn được ưu tiên.
- **Hành động mặc định**: Nếu không có quy tắc nào khớp, lưu lượng được phép đi qua trừ khi có quy tắc `deny` cuối cùng (như quy tắc 20 trong ví dụ).
- **Sao lưu cấu hình**: Luôn sao lưu trước khi thay đổi:
  ```
  $ save /config/backup-20250908.conf
  ```
- **Kiểm tra lỗi**: Nếu `commit` thất bại, đọc thông báo lỗi (ví dụ: địa chỉ IP không hợp lệ, giao diện không tồn tại).
- **Hiệu suất**: Access List đơn giản hơn tường lửa, phù hợp cho lọc IP cơ bản. Sử dụng tường lửa cho các tiêu chí phức tạp như cổng hoặc giao thức.

## Kết luận
Access List Policy trong vRouterOS cung cấp một phương pháp đơn giản và hiệu quả để kiểm soát lưu lượng mạng dựa trên địa chỉ IP. Sử dụng các lệnh `set`, `delete`, `commit`, `show`, và `save` để cấu hình và quản lý Access List. Thực hành các ví dụ trên để làm quen với quy trình và đảm bảo kiểm soát lưu lượng mạng hiệu quả.