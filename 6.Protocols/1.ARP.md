# Hướng dẫn cấu hình ARP trong vRouterOS

## Giới thiệu

**Address Resolution Protocol (ARP)** trong **vRouterOS** là giao thức dùng để ánh xạ địa chỉ IP (Layer 3) sang địa chỉ MAC (Layer 2) trong mạng Ethernet. ARP đóng vai trò quan trọng trong việc đảm bảo giao tiếp giữa các thiết bị trong cùng một mạng LAN. vRouterOS cung cấp các công cụ để quản lý bảng ARP, bao gồm cấu hình các mục ARP tĩnh, kiểm soát hành vi ARP, và giám sát trạng thái ARP.

Tài liệu này hướng dẫn cách:
- Cấu hình các mục ARP tĩnh.
- Kích hoạt hoặc vô hiệu hóa các tính năng liên quan đến ARP, như Proxy ARP.
- Kiểm tra và quản lý bảng ARP.

Các lệnh được thực thi trong **chế độ vận hành** (ký hiệu `$`) hoặc **chế độ cấu hình** (ký hiệu `#`). Các thay đổi cần được **commit** để có hiệu lực và **lưu** để duy trì sau khi khởi động lại.

## Tổng quan về ARP

- **ARP (Address Resolution Protocol)**: Giao thức dùng để tìm địa chỉ MAC tương ứng với một địa chỉ IP trong mạng cục bộ (LAN). Khi một thiết bị cần gửi gói tin, nó sử dụng ARP để xác định địa chỉ MAC đích.
- **Bảng ARP**: Lưu trữ các ánh xạ IP-MAC, được cập nhật động (qua ARP request/reply) hoặc cấu hình tĩnh.
- **Proxy ARP**: Cho phép vRouterOS trả lời các yêu cầu ARP thay cho thiết bị khác, thường dùng trong các kịch bản định tuyến hoặc NAT.
- **ARP tĩnh**: Ánh xạ IP-MAC cố định, không bị hết hạn, hữu ích để đảm bảo tính ổn định hoặc bảo mật.
- **Ứng dụng**: ARP được sử dụng trong các mạng Ethernet, VLAN, hoặc các kịch bản liên quan đến định tuyến và chuyển tiếp gói tin.

## Các lệnh cấu hình ARP

### 1. Cấu hình mục ARP tĩnh
- **Mô tả**: Thêm một ánh xạ IP-MAC tĩnh vào bảng ARP của một giao diện.
- **Lệnh**:
  ```
  # set interfaces <interface> ip arp static <ip-address> <mac-address>
  ```
  - `<interface>`: Tên giao diện (ví dụ: `eth0`, `dp0s3`).
  - `<ip-address>`: Địa chỉ IP cần ánh xạ.
  - `<mac-address>`: Địa chỉ MAC tương ứng (định dạng `xx:xx:xx:xx:xx:xx`).
- **Ví dụ**:
  ```
  $ configure
  # set interfaces eth0 ip arp static 192.168.1.100 00:50:56:ab:cd:ef
  # commit
  # save
  Saving configuration to '/config/config.boot'...
  Done
  ```
  - Thêm mục ARP tĩnh: IP `192.168.1.100` ánh xạ đến MAC `00:50:56:ab:cd:ef` trên giao diện `eth0`.

### 2. Kích hoạt Proxy ARP
- **Mô tả**: Cho phép vRouterOS trả lời các yêu cầu ARP thay cho thiết bị khác trên một giao diện.
- **Lệnh**:
  ```
  # set interfaces <interface> ip proxy-arp
  ```
- **Ví dụ**:
  ```
  # set interfaces eth0 ip proxy-arp
  # commit
  # save
  ```
  - Kích hoạt Proxy ARP trên giao diện `eth0`, cho phép vRouterOS trả lời ARP request cho các IP không thuộc giao diện này.

### 3. Vô hiệu hóa Proxy ARP
- **Mô tả**: Tắt Proxy ARP trên giao diện.
- **Lệnh**:
  ```
  # delete interfaces <interface> ip proxy-arp
  ```
- **Ví dụ**:
  ```
  # delete interfaces eth0 ip proxy-arp
  # commit
  # save
  ```
  - Vô hiệu hóa Proxy ARP trên giao diện `eth0`.

### 4. Kiểm tra bảng ARP
- **Mô tả**: Hiển thị bảng ARP hiện tại, bao gồm các mục động và tĩnh.
- **Lệnh**:
  ```
  $ show ip arp
  ```
- **Ví dụ**:
  ```
  $ show ip arp
  Address         HWaddress           Interface
  192.168.1.100   00:50:56:ab:cd:ef   eth0 (static)
  192.168.1.101   00:50:56:12:34:56   eth0
  ```
  - Hiển thị bảng ARP, trong đó `192.168.1.100` là mục tĩnh, còn `192.168.1.101` là mục động.

### 5. Xóa mục ARP tĩnh
- **Mô tả**: Xóa một mục ARP tĩnh khỏi giao diện.
- **Lệnh**:
  ```
  # delete interfaces <interface> ip arp static <ip-address>
  ```
- **Ví dụ**:
  ```
  $ configure
  # delete interfaces eth0 ip arp static 192.168.1.100
  # commit
  # save
  ```
  - Xóa mục ARP tĩnh cho IP `192.168.1.100` trên giao diện `eth0`.

### 6. Xóa bảng ARP động
- **Mô tả**: Xóa các mục ARP động trong bảng ARP.
- **Lệnh**:
  ```
  $ clear arp [interface <interface>] [address <ip-address>]
  ```
- **Ví dụ**:
  ```
  $ clear arp interface eth0
  ```
  - Xóa tất cả các mục ARP động trên giao diện `eth0`.
  ```
  $ clear arp address 192.168.1.101
  ```
  - Xóa mục ARP động cho IP `192.168.1.101`.

### 7. Kiểm tra cấu hình ARP
- **Mô tả**: Xem cấu hình ARP hiện tại.
- **Lệnh**:
  - Trong chế độ cấu hình:
    ```
    # show interfaces <interface> ip arp
    ```
  - Trong chế độ vận hành:
    ```
    $ show configuration commands | match arp
    ```
- **Ví dụ**:
  ```
  # show interfaces eth0 ip arp
  ip {
      arp {
          static {
              192.168.1.100 00:50:56:ab:cd:ef
          }
      }
      proxy-arp
  }
  ```

### 8. So sánh và hủy bỏ thay đổi
- **So sánh cấu hình**:
  ```
  # compare
  ```
  - Hiển thị sự khác biệt giữa cấu hình làm việc và cấu hình đang chạy.
  - Ví dụ:
    ```
    # compare
    + interfaces eth0 ip arp static 192.168.1.100 00:50:56:ab:cd:ef
    + interfaces eth0 ip proxy-arp
    ```
- **Hủy bỏ thay đổi**:
  ```
  # discard
  ```
  - Hủy các thay đổi chưa commit.

## Ví dụ thực tế: Cấu hình ARP tĩnh và Proxy ARP
1. Vào chế độ cấu hình:
   ```
   $ configure
   ```
2. Thêm mục ARP tĩnh:
   ```
   # set interfaces eth0 ip arp static 192.168.1.100 00:50:56:ab:cd:ef
   ```
3. Kích hoạt Proxy ARP:
   ```
   # set interfaces eth0 ip proxy-arp
   ```
4. Kiểm tra cấu hình:
   ```
   # show interfaces eth0 ip arp
   ip {
       arp {
           static {
               192.168.1.100 00:50:56:ab:cd:ef
           }
       }
       proxy-arp
   }
   ```
5. Áp dụng và lưu:
   ```
   # commit
   # save
   Saving configuration to '/config/config.boot'...
   Done
   # exit
   ```
6. Kiểm tra bảng ARP:
   ```
   $ show ip arp
   Address         HWaddress           Interface
   192.168.1.100   00:50:56:ab:cd:ef   eth0 (static)
   192.168.1.101   00:50:56:12:34:56   eth0
   ```
7. Xóa mục ARP động (nếu cần):
   ```
   $ clear arp address 192.168.1.101
   ```

## Lưu ý quan trọng
- **ARP tĩnh**: Sử dụng ARP tĩnh để đảm bảo ánh xạ IP-MAC không thay đổi, đặc biệt trong các kịch bản yêu cầu bảo mật hoặc thiết bị cố định (như server).
- **Proxy ARP**: Cẩn thận khi bật Proxy ARP, vì nó có thể gây nhầm lẫn trong mạng nếu không được cấu hình đúng (ví dụ: trả lời ARP cho IP không thuộc mạng cục bộ).
- **Sao lưu cấu hình**: Luôn sao lưu trước khi thay đổi:
  ```
  $ save /config/backup-20250908.conf
  ```
- **Kiểm tra lỗi**: Nếu `commit` thất bại, đọc thông báo lỗi (ví dụ: địa chỉ MAC không hợp lệ, giao diện không tồn tại).
- **Hiệu suất mạng**: Bảng ARP lớn hoặc Proxy ARP không đúng có thể ảnh hưởng đến hiệu suất. Theo dõi bằng:
  ```
  $ show system cpu
  ```

## Kết luận
Cấu hình ARP trong vRouterOS cho phép quản trị viên quản lý ánh xạ IP-MAC và kiểm soát hành vi ARP một cách hiệu quả. Sử dụng các lệnh `set`, `delete`, `commit`, `show`, và `save` để cấu hình ARP tĩnh và Proxy ARP. Thực hành các ví dụ trên để làm quen với quy trình và đảm bảo giao tiếp mạng ổn định trong môi trường LAN.