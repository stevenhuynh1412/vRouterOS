# Hướng dẫn cấu hình RIP trong vRouterOS

## Giới thiệu

**Routing Information Protocol (RIP)** là một giao thức định tuyến động dựa trên thuật toán vector khoảng cách (distance-vector), được sử dụng để trao đổi thông tin định tuyến trong các mạng nội bộ nhỏ đến trung bình. Trong **vRouterOS**, RIP được triển khai dựa trên FRRouting (FRR), hỗ trợ cả phiên bản RIP v1 và v2, cung cấp khả năng cấu hình đơn giản và hiệu quả cho các mạng LAN.

Tài liệu này hướng dẫn cách:
- Cấu hình RIP cơ bản, bao gồm kích hoạt RIP và quảng bá mạng.
- Áp dụng các chính sách định tuyến như Prefix List hoặc Route Map.
- Kiểm tra và giám sát trạng thái RIP.

Các lệnh được thực thi trong **chế độ vận hành** (ký hiệu `$`) hoặc **chế độ cấu hình** (ký hiệu `#`). Các thay đổi cần được **commit** để có hiệu lực và **lưu** để duy trì sau khi khởi động lại.

## Tổng quan về RIP

- **RIP**: Giao thức định tuyến sử dụng UDP (cổng 520) để trao đổi thông tin định tuyến. RIP tính toán tuyến đường dựa trên số bước nhảy (hop count) với tối đa 15 bước nhảy.
- **Phiên bản**:
  - **RIP v1**: Hỗ trợ quảng bá tuyến đường không có thông tin lớp mạng (classful), không hỗ trợ xác thực.
  - **RIP v2**: Hỗ trợ quảng bá tuyến đường có thông tin lớp mạng (classless), xác thực MD5, và gửi cập nhật qua multicast (224.0.0.9).
- **Ứng dụng**: RIP phù hợp cho các mạng nội bộ nhỏ, nơi cấu hình đơn giản và không yêu cầu xử lý bảng định tuyến lớn.
- **Thuộc tính chính**:
  - Metric: Dựa trên số bước nhảy (1-15, 16 là vô cực - tuyến đường không khả dụng).
  - Cập nhật định kỳ: Mặc định 30 giây.
  - Hỗ trợ xác thực: RIP v2 hỗ trợ xác thực để tăng cường bảo mật.

## Các lệnh cấu hình RIP

### 1. Kích hoạt RIP
- **Mô tả**: Kích hoạt giao thức RIP trên router.
- **Lệnh**:
  ```
  # set protocols rip
  ```
- **Ví dụ**:
  ```
  $ configure
  # set protocols rip
  # commit
  # save
  Saving configuration to '/config/config.boot'...
  Done
  ```
  - Kích hoạt RIP trên hệ thống.

### 2. Quảng bá mạng
- **Mô tả**: Chỉ định các mạng (prefix) để RIP quảng bá.
- **Lệnh**:
  ```
  # set protocols rip network <network/prefix>
  ```
- **Ví dụ**:
  ```
  # set protocols rip network 192.168.1.0/24
  # commit
  # save
  ```
  - Quảng bá mạng `192.168.1.0/24` qua RIP.

### 3. Cấu hình giao diện RIP
- **Mô tả**: Kích hoạt RIP trên các giao diện cụ thể.
- **Lệnh**:
  ```
  # set protocols rip interface <interface>
  ```
- **Ví dụ**:
  ```
  # set protocols rip interface eth0
  # commit
  # save
  ```
  - Kích hoạt RIP trên giao diện `eth0`.

### 4. Cấu hình RIP phiên bản 2
- **Mô tả**: Chỉ định sử dụng RIP v2 trên giao diện để hỗ trợ classless routing và xác thực.
- **Lệnh**:
  ```
  # set protocols rip interface <interface> version 2
  ```
- **Ví dụ**:
  ```
  # set protocols rip interface eth0 version 2
  # commit
  # save
  ```
  - Sử dụng RIP v2 trên giao diện `eth0`.

### 5. Cấu hình xác thực RIP v2
- **Mô tả**: Thiết lập xác thực MD5 cho RIP v2 để tăng cường bảo mật.
- **Lệnh**:
  ```
  # set protocols rip interface <interface> authentication md5 key-id <id> md5-key <key>
  ```
  - `<id>`: ID khóa xác thực (1-255).
  - `<key>`: Chuỗi khóa xác thực.
- **Ví dụ**:
  ```
  # set protocols rip interface eth0 authentication md5 key-id 1 md5-key mysecretkey
  # commit
  # save
  ```
  - Thiết lập xác thực MD5 với ID 1 và khóa `mysecretkey` trên giao diện `eth0`.

### 6. Áp dụng chính sách định tuyến
- **Mô tả**: Sử dụng Route Map hoặc Prefix List để lọc tuyến đường RIP.
- **Lệnh**:
  ```
  # set protocols rip distribute-list route-map <map-name>
  # set protocols rip distribute-list prefix-list <list-name> <in|out>
  ```
- **Ví dụ**:
  ```
  # set policy route-map RIP_CONTROL rule 10 action permit
  # set policy route-map RIP_CONTROL rule 10 match ip address prefix-list RIP_FILTER
  # set protocols rip distribute-list route-map RIP_CONTROL
  # commit
  # save
  ```
  - Áp dụng Route Map `RIP_CONTROL` để lọc các tuyến đường RIP.

### 7. Kiểm tra trạng thái RIP
- **Mô tả**: Hiển thị thông tin về trạng thái RIP, láng giềng, và bảng định tuyến.
- **Lệnh**:
  ```
  $ show ip rip
  $ show ip rip neighbor
  $ show ip rip status
  ```
- **Ví dụ**:
  ```
  $ show ip rip status
  Routing Protocol is "rip"
  RIP is running on interfaces: eth0
  Networks advertised: 192.168.1.0/24
  Neighbors: 192.168.1.2
  ```
  - Hiển thị trạng thái RIP, danh sách giao diện, mạng quảng bá, và láng giềng.

### 8. Xóa cấu hình RIP
- **Mô tả**: Xóa cấu hình RIP hoặc một phần của nó.
- **Lệnh**:
  ```
  # delete protocols rip network <network/prefix>
  # delete protocols rip interface <interface>
  # delete protocols rip
  ```
- **Ví dụ**:
  ```
  $ configure
  # delete protocols rip network 192.168.1.0/24
  # commit
  # save
  ```
  - Xóa mạng `192.168.1.0/24` khỏi quảng bá RIP.
  ```
  # delete protocols rip
  # commit
  # save
  ```
  - Xóa toàn bộ cấu hình RIP.

### 9. So sánh và hủy bỏ thay đổi
- **So sánh cấu hình**:
  ```
  # compare
  ```
  - Hiển thị sự khác biệt giữa cấu hình làm việc và cấu hình đang chạy.
  - Ví dụ:
    ```
    # compare
    + protocols rip network 192.168.1.0/24
    + protocols rip interface eth0
    ```
- **Hủy bỏ thay đổi**:
  ```
  # discard
  ```
  - Hủy các thay đổi chưa commit.

## Ví dụ thực tế: Cấu hình RIP cơ bản
1. Vào chế độ cấu hình:
   ```
   $ configure
   ```
2. Kích hoạt RIP:
   ```
   # set protocols rip
   ```
3. Quảng bá mạng:
   ```
   # set protocols rip network 192.168.1.0/24
   # set protocols rip network 192.168.2.0/24
   ```
4. Kích hoạt RIP trên giao diện:
   ```
   # set protocols rip interface eth0
   # set protocols rip interface eth0 version 2
   ```
5. Cấu hình xác thực MD5:
   ```
   # set protocols rip interface eth0 authentication md5 key-id 1 md5-key mysecretkey
   ```
6. Kiểm tra cấu hình:
   ```
   # show protocols rip
   rip {
       interface eth0 {
           authentication {
               md5 {
                   key-id 1 {
                       md5-key mysecretkey
                   }
               }
           }
           version 2
       }
       network 192.168.1.0/24
       network 192.168.2.0/24
   }
   ```
7. Áp dụng và lưu:
   ```
   # commit
   # save
   Saving configuration to '/config/config.boot'...
   Done
   # exit
   ```
8. Kiểm tra trạng thái:
   ```
   $ show ip rip status
   Routing Protocol is "rip"
   RIP is running on interfaces: eth0
   Networks advertised: 192.168.1.0/24, 192.168.2.0/24
   Neighbors: 192.168.1.2
   ```

## Lưu ý quan trọng
- **Giới hạn của RIP**: RIP chỉ phù hợp cho mạng nhỏ (tối đa 15 bước nhảy). Đối với mạng lớn, nên sử dụng OSPF hoặc BGP.
- **Xác thực**: Sử dụng RIP v2 với xác thực MD5 để tăng cường bảo mật, đặc biệt trong môi trường không tin cậy.
- **Chính sách định tuyến**: Sử dụng Prefix List hoặc Route Map để kiểm soát tuyến đường và tránh quảng bá không mong muốn.
- **Sao lưu cấu hình**: Luôn sao lưu trước khi thay đổi:
  ```
  $ save /config/backup-20250908.conf
  ```
- **Kiểm tra lỗi**: Nếu `commit` thất bại, đọc thông báo lỗi (ví dụ: giao diện không tồn tại, mạng không hợp lệ).
- **Hiệu suất hệ thống**: RIP có thể tiêu tốn tài nguyên nếu bảng định tuyến lớn. Theo dõi bằng:
  ```
  $ show system cpu
  ```

## Kết luận
Cấu hình RIP trong vRouterOS cung cấp một giải pháp đơn giản để triển khai định tuyến động trong các mạng nội bộ nhỏ đến trung bình. Sử dụng các lệnh `set`, `delete`, `commit`, `show`, và `save` để cấu hình và quản lý RIP hiệu quả. Thực hành các ví dụ trên để làm quen với quy trình và đảm bảo định tuyến RIP hoạt động ổn định và an toàn.