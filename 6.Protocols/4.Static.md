# Hướng dẫn cấu hình định tuyến tĩnh trong vRouterOS

## Giới thiệu

**Định tuyến tĩnh (Static Routing)** trong **vRouterOS** là phương pháp cấu hình các tuyến đường cố định trong bảng định tuyến để điều hướng lưu lượng mạng đến các đích cụ thể. Định tuyến tĩnh phù hợp cho các mạng nhỏ hoặc các kịch bản mà các tuyến đường không cần thay đổi động, chẳng hạn như kết nối đến mạng con hoặc định tuyến mặc định đến cổng ra Internet.

Tài liệu này hướng dẫn cách:
- Cấu hình các tuyến tĩnh cơ bản, bao gồm tuyến đến mạng cụ thể và tuyến mặc định.
- Quản lý các tuyến tĩnh với các tham số như khoảng cách hành chính (administrative distance) hoặc nhãn (tag).
- Kiểm tra và giám sát bảng định tuyến tĩnh.

Các lệnh được thực thi trong **chế độ vận hành** (ký hiệu `$`) hoặc **chế độ cấu hình** (ký hiệu `#`). Các thay đổi cần được **commit** để có hiệu lực và **lưu** để duy trì sau khi khởi động lại.

## Tổng quan về định tuyến tĩnh

- **Định tuyến tĩnh**: Các tuyến đường được cấu hình thủ công bởi quản trị viên, không phụ thuộc vào giao thức định tuyến động như BGP hoặc OSPF.
- **Ứng dụng**:
  - Cấu hình tuyến mặc định (default route) để gửi lưu lượng ra Internet qua cổng ra (gateway).
  - Định tuyến đến các mạng con cụ thể trong mạng nội bộ.
  - Sử dụng trong các kịch bản đơn giản không cần giao thức định tuyến động.
- **Thuộc tính chính**:
  - **Next-hop**: Địa chỉ IP của router kế tiếp để chuyển tiếp lưu lượng.
  - **Interface**: Giao diện mà lưu lượng sẽ được gửi qua.
  - **Distance**: Khoảng cách hành chính (administrative distance) để ưu tiên tuyến đường (mặc định là 1).
  - **Tag**: Nhãn để quản lý hoặc tham chiếu tuyến đường trong các chính sách định tuyến.
- **Ưu điểm**: Đơn giản, dễ cấu hình, phù hợp cho mạng nhỏ hoặc tĩnh.
- **Hạn chế**: Không tự động cập nhật khi mạng thay đổi, yêu cầu quản trị viên can thiệp thủ công.

## Các lệnh cấu hình định tuyến tĩnh

### 1. Cấu hình tuyến tĩnh cơ bản
- **Mô tả**: Thêm một tuyến tĩnh đến một mạng cụ thể với địa chỉ next-hop.
- **Lệnh**:
  ```
  # set protocols static route <destination> next-hop <next-hop-ip>
  ```
  - `<destination>`: Địa chỉ mạng đích (ví dụ: `192.168.2.0/24` hoặc `0.0.0.0/0` cho tuyến mặc định).
  - `<next-hop-ip>`: Địa chỉ IP của router kế tiếp.
- **Ví dụ**:
  ```
  $ configure
  # set protocols static route 192.168.2.0/24 next-hop 192.168.1.2
  # commit
  # save
  Saving configuration to '/config/config.boot'...
  Done
  ```
  - Thêm tuyến tĩnh: Lưu lượng đến `192.168.2.0/24` được chuyển tiếp qua `192.168.1.2`.

### 2. Cấu hình tuyến mặc định
- **Mô tả**: Thiết lập tuyến mặc định (default route) để gửi tất cả lưu lượng không khớp với tuyến cụ thể đến một next-hop.
- **Lệnh**:
  ```
  # set protocols static route 0.0.0.0/0 next-hop <next-hop-ip>
  ```
- **Ví dụ**:
  ```
  # set protocols static route 0.0.0.0/0 next-hop 192.168.1.1
  # commit
  # save
  ```
  - Cấu hình tuyến mặc định: Tất cả lưu lượng không khớp được gửi đến `192.168.1.1`.

### 3. Cấu hình tuyến tĩnh với giao diện
- **Mô tả**: Chỉ định giao diện mà lưu lượng sẽ được gửi qua, thay vì hoặc kết hợp với next-hop.
- **Lệnh**:
  ```
  # set protocols static route <destination> interface <interface>
  ```
- **Ví dụ**:
  ```
  # set protocols static route 192.168.2.0/24 interface eth1
  # commit
  # save
  ```
  - Lưu lượng đến `192.168.2.0/24` được gửi qua giao diện `eth1`.

### 4. Cấu hình khoảng cách hành chính (Administrative Distance)
- **Mô tả**: Chỉ định giá trị khoảng cách hành chính để ưu tiên tuyến tĩnh so với các tuyến khác.
- **Lệnh**:
  ```
  # set protocols static route <destination> next-hop <next-hop-ip> distance <value>
  ```
  - `<value>`: Giá trị từ 1-255 (mặc định là 1, thấp hơn nghĩa là ưu tiên cao hơn).
- **Ví dụ**:
  ```
  # set protocols static route 192.168.2.0/24 next-hop 192.168.1.2 distance 10
  # commit
  # save
  ```
  - Đặt khoảng cách hành chính là 10 cho tuyến đến `192.168.2.0/24`.

### 5. Cấu hình tuyến tĩnh với nhãn (Tag)
- **Mô tả**: Gắn nhãn cho tuyến tĩnh để sử dụng trong các chính sách định tuyến.
- **Lệnh**:
  ```
  # set protocols static route <destination> tag <tag-value>
  ```
- **Ví dụ**:
  ```
  # set protocols static route 192.168.2.0/24 tag 100
  # commit
  # save
  ```
  - Gắn nhãn 100 cho tuyến đến `192.168.2.0/24`.

### 6. Kiểm tra bảng định tuyến
- **Mô tả**: Hiển thị bảng định tuyến tĩnh và trạng thái định tuyến hiện tại.
- **Lệnh**:
  ```
  $ show ip route
  $ show ip route static
  ```
- **Ví dụ**:
  ```
  $ show ip route static
  Codes: K - kernel route, C - connected, S - static, ...
  S   192.168.2.0/24 [1/0] via 192.168.1.2, eth0
  S   0.0.0.0/0 [1/0] via 192.168.1.1, eth0
  ```
  - Hiển thị các tuyến tĩnh: `192.168.2.0/24` qua `192.168.1.2` và tuyến mặc định qua `192.168.1.1`.

### 7. Xóa tuyến tĩnh
- **Mô tả**: Xóa một tuyến tĩnh hoặc toàn bộ cấu hình định tuyến tĩnh.
- **Lệnh**:
  ```
  # delete protocols static route <destination>
  ```
- **Ví dụ**:
  ```
  $ configure
  # delete protocols static route 192.168.2.0/24
  # commit
  # save
  ```
  - Xóa tuyến tĩnh đến `192.168.2.0/24`.
  ```
  # delete protocols static
  # commit
  # save
  ```
  - Xóa toàn bộ cấu hình định tuyến tĩnh.

### 8. So sánh và hủy bỏ thay đổi
- **So sánh cấu hình**:
  ```
  # compare
  ```
  - Hiển thị sự khác biệt giữa cấu hình làm việc và cấu hình đang chạy.
  - Ví dụ:
    ```
    # compare
    + protocols static route 192.168.2.0/24 next-hop 192.168.1.2
    ```
- **Hủy bỏ thay đổi**:
  ```
  # discard
  ```
  - Hủy các thay đổi chưa commit.

## Ví dụ thực tế: Cấu hình định tuyến tĩnh
1. Vào chế độ cấu hình:
   ```
   $ configure
   ```
2. Thêm tuyến mặc định:
   ```
   # set protocols static route 0.0.0.0/0 next-hop 192.168.1.1
   ```
3. Thêm tuyến tĩnh đến mạng cụ thể:
   ```
   # set protocols static route 192.168.2.0/24 next-hop 192.168.1.2 distance 10
   ```
4. Gắn nhãn cho tuyến:
   ```
   # set protocols static route 192.168.2.0/24 tag 100
   ```
5. Kiểm tra cấu hình:
   ```
   # show protocols static
   static {
       route 0.0.0.0/0 {
           next-hop 192.168.1.1
       }
       route 192.168.2.0/24 {
           next-hop 192.168.1.2 {
               distance 10
           }
           tag 100
       }
   }
   ```
6. Áp dụng và lưu:
   ```
   # commit
   # save
   Saving configuration to '/config/config.boot'...
   Done
   # exit
   ```
7. Kiểm tra bảng định tuyến:
   ```
   $ show ip route static
   Codes: K - kernel route, C - connected, S - static, ...
   S   0.0.0.0/0 [1/0] via 192.168.1.1, eth0
   S   192.168.2.0/24 [10/0] via 192.168.1.2, eth0
   ```

## Lưu ý quan trọng
- **Ưu tiên tuyến đường**: Tuyến tĩnh có khoảng cách hành chính thấp hơn (mặc định là 1) được ưu tiên hơn các tuyến từ giao thức động (như OSPF, BGP). Cẩn thận khi sử dụng cùng các giao thức định tuyến khác.
- **Kiểm tra kết nối**: Đảm bảo next-hop hoặc giao diện tồn tại và khả dụng trước khi cấu hình.
- **Sao lưu cấu hình**: Luôn sao lưu trước khi thay đổi:
  ```
  $ save /config/backup-20250908.conf
  ```
- **Kiểm tra lỗi**: Nếu `commit` thất bại, đọc thông báo lỗi (ví dụ: next-hop không hợp lệ, giao diện không tồn tại).
- **Hiệu suất hệ thống**: Định tuyến tĩnh sử dụng ít tài nguyên, nhưng bảng định tuyến lớn có thể ảnh hưởng đến hiệu suất. Theo dõi bằng:
  ```
  $ show system cpu
  ```

## Kết luận
Cấu hình định tuyến tĩnh trong vRouterOS cung cấp một giải pháp đơn giản và hiệu quả để điều hướng lưu lượng trong các mạng nhỏ hoặc tĩnh. Sử dụng các lệnh `set`, `delete`, `commit`, `show`, và `save` để cấu hình và quản lý các tuyến tĩnh. Thực hành các ví dụ trên để làm quen với quy trình và đảm bảo định tuyến mạng hoạt động ổn định và chính xác.